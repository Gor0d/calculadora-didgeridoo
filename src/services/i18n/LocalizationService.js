/**
 * Localization Service for Didgeridoo Calculator
 * Supports PT-BR and EN-US
 */

import AsyncStorage from '@react-native-async-storage/async-storage';

class LocalizationService {
  constructor() {
    this.currentLanguage = 'pt-BR';
    this.translations = {
      'pt-BR': {
        // App General
        appName: 'Didgemap',
        appSubtitle: 'Calculadora Avan√ßada de Didgeridoo',
        
        // Header Features
        acousticAnalysis: 'üîç An√°lise Ac√∫stica',
        visualization: 'üìä Visualiza√ß√£o',
        audioPreview: 'üéµ Preview Sonoro',
        
        // Unit System
        unitSystem: 'üìè Sistema de Unidades',
        metric: 'M√©trico',
        imperial: 'Imperial',
        metricSubLabel: 'cm/mm',
        imperialSubLabel: 'inches',
        metricHelp: 'Use cent√≠metros para posi√ß√£o e mil√≠metros para di√¢metro',
        imperialHelp: 'Use inches for both position and diameter (fractions supported)',
        
        // Quick Examples
        quickExamples: '‚ö° Exemplos r√°pidos:',
        loadFile: 'üìÇ Arquivo',
        traditional: 'üé∫ Tradicional',
        traditionalDesc: 'Cl√°ssico australiano',
        straight: 'üìè Reto',
        straightDesc: 'Tubo uniforme',
        bell: 'üîî Campana',
        bellDesc: 'Abertura em sino',
        wavy: 'üåä Ondulado',
        wavyDesc: 'Varia√ß√µes suaves',
        aggressive: '‚ö° Agressivo',
        aggressiveDesc: 'Mudan√ßas bruscas',
        precision: 'üéØ Precis√£o',
        precisionDesc: 'Medidas exatas',
        biodrone: 'üî• BioDrone',
        biodroneDesc: 'Design Renan',
        
        // Geometry Input
        geometryTitle: 'üìê Geometria do Didgeridoo',
        geometryFormat: 'Formato: posi√ß√£o(cm) di√¢metro(mm)',
        geometryFormatImperial: 'Formato: posi√ß√£o(") di√¢metro(")',
        analyze: 'üî¨ Analisar',
        analyzing: 'üîÑ Analisando...',
        visualize: 'üìä Visualizar',
        hide: 'üëÅÔ∏è Ocultar',
        
        // Stats
        length: 'COMPRIMENTO',
        diameter: 'DI√ÇMETRO',
        points: 'PONTOS',
        volume: 'VOLUME',
        
        // Analysis Results
        analysisResults: 'üéº Resultados da An√°lise Ac√∫stica',
        harmonicSeries: 'S√©rie Harm√¥nica:',
        fundamental: 'Fundamental',
        harmonic: 'Harm√¥nico',
        frequency: 'Freq',
        note: 'Nota',
        cents: 'Cents',
        amplitude: 'Amplitude',
        quality: 'Qualidade',
        playDrone: 'üéµ Drone',
        playHarmonics: 'üé∫ Harm√¥nicos',
        playFullSpectrum: 'üéº Espectro',
        
        // Audio
        playingDrone: 'üéµ Drone do Didgeridoo',
        frequencyLabel: 'Frequ√™ncia',
        noteLabel: 'Nota',
        lowFreq: 'üîä Grave - Vibra√ß√µes lentas e pesadas',
        midFreq: 'üéØ M√©dio - Vibra√ß√µes balanceadas',
        highFreq: '‚ö° Agudo - Vibra√ß√µes r√°pidas e leves',
        
        // Projects
        recentProjects: 'üìÇ Projetos Recentes',
        noProjects: 'Nenhum projeto salvo ainda.',
        saveProject: 'üíæ Salvar Projeto',
        newProject: 'Novo Projeto',
        enterProjectName: 'Digite o nome do projeto:',
        projectSaved: '‚úÖ Projeto Salvo',
        projectSavedSuccess: 'foi salvo com sucesso!',
        loadProject: 'Carregar Projeto',
        confirmLoad: 'Deseja carregar este projeto? Dados n√£o salvos ser√£o perdidos.',
        load: 'Carregar',
        
        // Validation & Errors
        validationError: '‚ö†Ô∏è Erro de Valida√ß√£o',
        analysisError: 'Erro de An√°lise',
        audioError: 'Erro de √Åudio',
        fileError: '‚ö†Ô∏è Arquivo com Problemas',
        fileLoaded: '‚úÖ Arquivo Carregado',
        fileLoadedSuccess: 'foi carregado com sucesso!',
        insufficientPoints: 'M√≠nimo 2 pontos necess√°rios',
        invalidSequence: 'deve ser maior que a anterior',
        lengthWarning: 'Comprimento muito longo',
        diameterWarning: 'Di√¢metros fora da faixa t√≠pica',
        
        // Onboarding
        welcome: 'Bem-vindo ao Didgemap',
        welcomeSubtitle: 'A primeira calculadora cient√≠fica de didgeridoo do mundo',
        welcomeDesc: 'Analise, projete e otimize didgeridoos com precis√£o profissional baseada em f√≠sica ac√∫stica real.',
        analysisTitle: 'An√°lise Ac√∫stica Avan√ßada',
        analysisSubtitle: 'C√°lculos baseados em equa√ß√µes de Webster',
        analysisDesc: 'Digite medidas simples e obtenha frequ√™ncias fundamentais, harm√¥nicos e an√°lise completa da resposta ac√∫stica.',
        visualizationTitle: 'Visualiza√ß√£o em Tempo Real',
        visualizationSubtitle: 'Veja a geometria interna do seu instrumento',
        visualizationDesc: 'Visualize o perfil interno, estat√≠sticas detalhadas e valida√ß√£o inteligente de medidas.',
        audioTitle: 'Preview Sonoro',
        audioSubtitle: 'Escute como seu didgeridoo vai soar',
        audioDesc: 'S√≠ntese de √°udio em tempo real com drone fundamental, harm√¥nicos e espectro completo.',
        projectsTitle: 'Sistema de Projetos',
        projectsSubtitle: 'Salve e gerencie seus designs',
        projectsDesc: 'Salvamento autom√°tico, hist√≥rico de projetos e exporta√ß√£o de dados para uso profissional.',
        skip: 'Pular',
        next: 'Pr√≥ximo',
        start: 'Come√ßar',
        
        // Language
        language: 'üåê Idioma',
        portuguese: 'Portugu√™s (BR)',
        english: 'English (US)',
        
        // Common Actions
        ok: 'OK',
        cancel: 'Cancelar',
        yes: 'Sim',
        no: 'N√£o',
        save: 'Salvar',
        delete: 'Excluir',
        edit: 'Editar',
        close: 'Fechar',
        
        // Settings
        settings: 'Configura√ß√µes',
        settingsDesc: 'Personalize sua experi√™ncia',
        preferences: 'Prefer√™ncias',
        hapticFeedback: 'Feedback H√°ptico',
        hapticFeedbackDesc: 'Vibra√ß√£o ao tocar bot√µes',
        autoSave: 'Salvamento Autom√°tico',
        autoSaveDesc: 'Salvar projetos automaticamente',
        dataManagement: 'Gerenciamento de Dados',
        exportData: 'Exportar Dados',
        exportDataDesc: 'Fazer backup de todos os projetos',
        exportDataShort: 'Backup completo dos projetos',
        importData: 'Importar Dados',
        importDataDesc: 'Restaurar projetos de backup',
        importDataShort: 'Restaurar backup',
        advanced: 'Avan√ßado',
        resetApp: 'Resetar Aplicativo',
        resetAppWarning: 'Isso ir√° apagar todos os dados. Continuar?',
        resetAppShort: 'Apagar todos os dados',
        resetOnboarding: 'Resetar Tutorial',
        resetOnboardingDesc: 'Mostrar tutorial inicial novamente',
        resetOnboardingSuccess: 'Tutorial ser√° mostrado no pr√≥ximo in√≠cio!',
        about: 'Sobre',
        version: 'Vers√£o',
        build: 'Build',
        developer: 'Desenvolvedor',
        madeWith: 'Feito com',
        forDidgeridoo: 'para didgeridoo',
        export: 'Exportar',
        import: 'Importar',
        reset: 'Resetar',
        
        // Navigation
        home: 'In√≠cio',
        projects: 'Projetos',
        
        // Additional translations
        geometryVisualization: 'Visualiza√ß√£o da Geometria',
        geometryVisualizationDesc: 'Perfil interno do didgeridoo',
        pleaseEnterGeometry: 'Por favor, insira a geometria do didgeridoo',
        analysisCalculationFailed: 'Falha no c√°lculo ac√∫stico',
        unexpectedError: 'Erro inesperado durante a an√°lise',
        audioNotReady: 'Sistema de √°udio n√£o est√° pronto',
        audioPlaybackError: 'N√£o foi poss√≠vel reproduzir o som',
        saveError: 'Erro ao Salvar',
        noGeometryToSave: 'Nenhuma geometria para salvar',
        failedToSaveProject: 'Falha ao salvar projeto',
        fileLoadedWithErrors: 'foi carregado, mas cont√©m erros',
        unknownError: 'Erro desconhecido',
        
        // Export/Import/Reset
        exportDataSuccess: 'Dados exportados com sucesso!',
        exportDataError: 'Erro ao exportar dados.',
        importDataSuccess: 'Dados importados com sucesso!',
        importDataError: 'Erro ao importar dados.',
        resetAppSuccess: 'Aplicativo resetado com sucesso!',
        resetAppError: 'Erro ao resetar aplicativo.',
        
        // Suggestions
        suggestions: 'Sugest√µes:',
        checkMeasurements: 'Verifique as medidas inseridas',
        useIncreasingPositions: 'Use posi√ß√µes crescentes',
        checkDiameters: 'Verifique os di√¢metros',
        addMorePoints: 'Adicione mais pontos de medi√ß√£o',
        
        // QuickExamples
        shareDesign: 'Compartilhar Design',
        shareDesignDesc: 'Envie suas medidas para adicionarmos aqui!',
        yourDesign: 'Seu Design',
        fileLoadingNotImplemented: 'Carregamento de arquivo n√£o implementado ainda'
      },
      
      'en-US': {
        // App General
        appName: 'Didgemap',
        appSubtitle: 'Advanced Didgeridoo Calculator',
        
        // Header Features
        acousticAnalysis: 'üîç Acoustic Analysis',
        visualization: 'üìä Visualization',
        audioPreview: 'üéµ Audio Preview',
        
        // Unit System
        unitSystem: 'üìè Unit System',
        metric: 'Metric',
        imperial: 'Imperial',
        metricSubLabel: 'cm/mm',
        imperialSubLabel: 'inches',
        metricHelp: 'Use centimeters for position and millimeters for diameter',
        imperialHelp: 'Use inches for both position and diameter (fractions supported)',
        
        // Quick Examples
        quickExamples: '‚ö° Quick examples:',
        loadFile: 'üìÇ File',
        traditional: 'üé∫ Traditional',
        traditionalDesc: 'Classic Australian',
        straight: 'üìè Straight',
        straightDesc: 'Uniform tube',
        bell: 'üîî Bell',
        bellDesc: 'Bell opening',
        wavy: 'üåä Wavy',
        wavyDesc: 'Smooth variations',
        aggressive: '‚ö° Aggressive',
        aggressiveDesc: 'Sharp changes',
        precision: 'üéØ Precision',
        precisionDesc: 'Exact measurements',
        biodrone: 'üî• BioDrone',
        biodroneDesc: 'Renan Design',
        
        // Geometry Input
        geometryTitle: 'üìê Didgeridoo Geometry',
        geometryFormat: 'Format: position(cm) diameter(mm)',
        geometryFormatImperial: 'Format: position(") diameter(")',
        analyze: 'üî¨ Analyze',
        analyzing: 'üîÑ Analyzing...',
        visualize: 'üìä Visualize',
        hide: 'üëÅÔ∏è Hide',
        
        // Stats
        length: 'LENGTH',
        diameter: 'DIAMETER',
        points: 'POINTS',
        volume: 'VOLUME',
        
        // Analysis Results
        analysisResults: 'üéº Acoustic Analysis Results',
        harmonicSeries: 'Harmonic Series:',
        fundamental: 'Fundamental',
        harmonic: 'Harmonic',
        frequency: 'Freq',
        note: 'Note',
        cents: 'Cents',
        amplitude: 'Amplitude',
        quality: 'Quality',
        playDrone: 'üéµ Drone',
        playHarmonics: 'üé∫ Harmonics',
        playFullSpectrum: 'üéº Spectrum',
        
        // Audio
        playingDrone: 'üéµ Didgeridoo Drone',
        frequencyLabel: 'Frequency',
        noteLabel: 'Note',
        lowFreq: 'üîä Low - Slow and heavy vibrations',
        midFreq: 'üéØ Mid - Balanced vibrations',
        highFreq: '‚ö° High - Fast and light vibrations',
        
        // Projects
        recentProjects: 'üìÇ Recent Projects',
        noProjects: 'No saved projects yet.',
        saveProject: 'üíæ Save Project',
        newProject: 'New Project',
        enterProjectName: 'Enter project name:',
        projectSaved: '‚úÖ Project Saved',
        projectSavedSuccess: 'was saved successfully!',
        loadProject: 'Load Project',
        confirmLoad: 'Load this project? Unsaved data will be lost.',
        load: 'Load',
        
        // Validation & Errors
        validationError: '‚ö†Ô∏è Validation Error',
        analysisError: 'Analysis Error',
        audioError: 'Audio Error',
        fileError: '‚ö†Ô∏è File Issues',
        fileLoaded: '‚úÖ File Loaded',
        fileLoadedSuccess: 'was loaded successfully!',
        insufficientPoints: 'Minimum 2 points required',
        invalidSequence: 'must be greater than previous',
        lengthWarning: 'Length very long',
        diameterWarning: 'Diameters outside typical range',
        
        // Onboarding
        welcome: 'Welcome to Didgemap',
        welcomeSubtitle: "The world's first scientific didgeridoo calculator",
        welcomeDesc: 'Analyze, design and optimize didgeridoos with professional precision based on real acoustic physics.',
        analysisTitle: 'Advanced Acoustic Analysis',
        analysisSubtitle: 'Calculations based on Webster equations',
        analysisDesc: 'Enter simple measurements and get fundamental frequencies, harmonics and complete acoustic response analysis.',
        visualizationTitle: 'Real-time Visualization',
        visualizationSubtitle: 'See your instrument internal geometry',
        visualizationDesc: 'Visualize internal profile, detailed statistics and intelligent measurement validation.',
        audioTitle: 'Audio Preview',
        audioSubtitle: 'Hear how your didgeridoo will sound',
        audioDesc: 'Real-time audio synthesis with fundamental drone, harmonics and full spectrum.',
        projectsTitle: 'Project System',
        projectsSubtitle: 'Save and manage your designs',
        projectsDesc: 'Auto-save, project history and data export for professional use.',
        skip: 'Skip',
        next: 'Next',
        start: 'Start',
        
        // Language
        language: 'üåê Language',
        portuguese: 'Portugu√™s (BR)',
        english: 'English (US)',
        
        // Common Actions
        ok: 'OK',
        cancel: 'Cancel',
        yes: 'Yes',
        no: 'No',
        save: 'Save',
        delete: 'Delete',
        edit: 'Edit',
        close: 'Close',
        
        // Settings
        settings: 'Settings',
        settingsDesc: 'Customize your experience',
        preferences: 'Preferences',
        hapticFeedback: 'Haptic Feedback',
        hapticFeedbackDesc: 'Vibration when tapping buttons',
        autoSave: 'Auto Save',
        autoSaveDesc: 'Save projects automatically',
        dataManagement: 'Data Management',
        exportData: 'Export Data',
        exportDataDesc: 'Backup all projects',
        exportDataShort: 'Complete project backup',
        importData: 'Import Data',
        importDataDesc: 'Restore projects from backup',
        importDataShort: 'Restore backup',
        advanced: 'Advanced',
        resetApp: 'Reset App',
        resetAppWarning: 'This will delete all data. Continue?',
        resetAppShort: 'Delete all data',
        resetOnboarding: 'Reset Tutorial',
        resetOnboardingDesc: 'Show initial tutorial again',
        resetOnboardingSuccess: 'Tutorial will be shown on next start!',
        about: 'About',
        version: 'Version',
        build: 'Build',
        developer: 'Developer',
        madeWith: 'Made with',
        forDidgeridoo: 'for didgeridoo',
        export: 'Export',
        import: 'Import',
        reset: 'Reset',
        
        // Navigation
        home: 'Home',
        projects: 'Projects',
        
        // Additional translations
        geometryVisualization: 'Geometry Visualization',
        geometryVisualizationDesc: 'Internal didgeridoo profile',
        pleaseEnterGeometry: 'Please enter didgeridoo geometry',
        analysisCalculationFailed: 'Acoustic calculation failed',
        unexpectedError: 'Unexpected error during analysis',
        audioNotReady: 'Audio system not ready',
        audioPlaybackError: 'Could not play sound',
        saveError: 'Save Error',
        noGeometryToSave: 'No geometry to save',
        failedToSaveProject: 'Failed to save project',
        fileLoadedWithErrors: 'was loaded but contains errors',
        unknownError: 'Unknown error',
        
        // Export/Import/Reset
        exportDataSuccess: 'Data exported successfully!',
        exportDataError: 'Error exporting data.',
        importDataSuccess: 'Data imported successfully!',
        importDataError: 'Error importing data.',
        resetAppSuccess: 'App reset successfully!',
        resetAppError: 'Error resetting app.',
        
        // Suggestions
        suggestions: 'Suggestions:',
        checkMeasurements: 'Check entered measurements',
        useIncreasingPositions: 'Use increasing positions',
        checkDiameters: 'Check diameters',
        addMorePoints: 'Add more measurement points',
        
        // QuickExamples
        shareDesign: 'Share Design',
        shareDesignDesc: 'Send us your measurements to add here!',
        yourDesign: 'Your Design',
        fileLoadingNotImplemented: 'File loading not implemented yet'
      }
    };
  }

  /**
   * Initialize localization service
   */
  async initialize() {
    try {
      const savedLanguage = await AsyncStorage.getItem('selectedLanguage');
      if (savedLanguage && this.translations[savedLanguage]) {
        this.currentLanguage = savedLanguage;
      } else {
        // Auto-detect system language
        const systemLanguage = this.getSystemLanguage();
        this.currentLanguage = this.translations[systemLanguage] ? systemLanguage : 'pt-BR';
      }
    } catch (error) {
      console.warn('Error loading saved language:', error);
      this.currentLanguage = 'pt-BR';
    }
  }

  /**
   * Get system language
   */
  getSystemLanguage() {
    // For React Native, we can use the device locale
    // This is a simplified version - in production you'd use react-native-localize
    const locale = 'pt-BR'; // Default fallback
    
    if (locale.startsWith('en')) return 'en-US';
    if (locale.startsWith('pt')) return 'pt-BR';
    
    return 'pt-BR'; // Default
  }

  /**
   * Set current language
   */
  async setLanguage(language) {
    if (!this.translations[language]) {
      console.warn('Language not supported:', language);
      return false;
    }
    
    this.currentLanguage = language;
    
    try {
      await AsyncStorage.setItem('selectedLanguage', language);
      return true;
    } catch (error) {
      console.warn('Error saving language preference:', error);
      return false;
    }
  }

  /**
   * Get current language
   */
  getCurrentLanguage() {
    return this.currentLanguage;
  }

  /**
   * Get available languages
   */
  getAvailableLanguages() {
    return [
      { code: 'pt-BR', name: 'Portugu√™s (BR)', flag: 'üáßüá∑' },
      { code: 'en-US', name: 'English (US)', flag: 'üá∫üá∏' }
    ];
  }

  /**
   * Translate a key
   */
  t(key, params = {}) {
    const translation = this.translations[this.currentLanguage][key] || 
                       this.translations['pt-BR'][key] || 
                       key;
    
    // Simple parameter substitution
    let result = translation;
    Object.keys(params).forEach(param => {
      result = result.replace(`{${param}}`, params[param]);
    });
    
    return result;
  }

  /**
   * Get all translations for current language
   */
  getTranslations() {
    return this.translations[this.currentLanguage];
  }

  /**
   * Check if key exists
   */
  hasTranslation(key) {
    return !!this.translations[this.currentLanguage][key];
  }

  /**
   * Get RTL direction (always false for PT-BR and EN-US)
   */
  isRTL() {
    return false;
  }

  /**
   * Format number according to locale
   */
  formatNumber(number, decimals = 1) {
    if (this.currentLanguage === 'en-US') {
      return number.toFixed(decimals);
    } else {
      // PT-BR uses comma as decimal separator
      return number.toFixed(decimals).replace('.', ',');
    }
  }

  /**
   * Get decimal separator
   */
  getDecimalSeparator() {
    return this.currentLanguage === 'en-US' ? '.' : ',';
  }
}

// Export singleton instance
export const localizationService = new LocalizationService();